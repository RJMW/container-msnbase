<?xml version='1.0' encoding='UTF-8'?>
<tool id="msp-to-metfrag" name="msp-to-metfrag" version="0.1">
  <requirements>
    <container type="docker">korseby/mtbls709</container>
  </requirements>
  <description>Read MS2 spectra from MSP file and create MetFrag parameter file.</description>
  <stdio>
    <regex match="" source="stderr" level="warning" description="R messages" />
    <exit_code range="1:" level="fatal" description="Tool error" />
  </stdio>
  <command><![CDATA[
echo $suspectfile;
/usr/local/bin/msp-to-metfrag.r $mspfile $suspectfile $metfragparameterfile $minintthr $minprop $pretofrag $fragtofrag $polarity $DatabaseSearchRelativeMassDeviation $FragmentPeakMatchAbsoluteMassDeviation $FragmentPeakMatchRelativeMassDeviation $MetFragDatabaseType $FilterExcludedElements $FilterIncludedElements;
  ]]>
  </command>
  <inputs>
    <param name="mspfile" type="data" format="txt" optional="False" label="MSP file" help="MSP file" />
    
    <param name="minintthr" type="text" value="100" optional="False" label="intensity threshold" help="Minimum intensity of maximal MS2 peak" />
    <param name="minprop" type="text" value="0.05" optional="False" label="minimum proportion" help="Minimum proportion of MS2 peaks" />
    <param name="pretofrag" type="select" value="True" optional="False" label="precursor to fragments" help="Neutral losses precursor to fragments">
      <option value="True" selected="True">True</option>
      <option value="False">False</option>
    </param>
    <param name="fragtofrag" type="select" value="False" optional="False" label="fragments to fragments" help="Neutral losses fragments to fragments">
      <option value="True">True</option>
      <option value="False" selected="True">False</option>
    </param>
    
    <param name="polarity" type="select" value="positive" optional="False" label="polarity" help="The polarity used for the mode of acquisition">
      <option value="positive" selected="True">positive</option>
      <option value="negative">negative</option>
    </param>
    <param name="DatabaseSearchRelativeMassDeviation" type="text" value="10" optional="False" label="Database Search Relative Mass Deviation" help="Database Search Relative Mass Deviation" />
    <param name="FragmentPeakMatchAbsoluteMassDeviation" type="text" value="0.001" optional="False" label="Fragment Peak Match Absolute Mass Deviation" help="Fragment Peak Match Absolute Mass Deviation" />
    <param name="FragmentPeakMatchRelativeMassDeviation" type="text" value="10" optional="False" label="Fragment Peak Match Relative Mass Deviation" help="Fragment Peak Match Relative Mass Deviation" />
    <param name="suspectfile" type="data" format="txt" optional="True" label="Suspect list" help="File containing a list of suspects" />
    <param name="MetFragDatabaseType" type="select" value="PubChem" optional="False" label="MetFrag Database Type" help="Database">
      <option value="PubChem" selected="True">PubChem</option>
      <option value="KEGG">KEGG</option>
      <option value="MetChem" selected="False">MetChem</option>
      <option value="LocalCSV" selected="False">CSV</option>
    </param>
    <param name="FilterExcludedElements" type="text" value="Cl,Br,F" optional="False" label="Filter Excluded Elements" help="List of elements that should be excluded. Elements are comma separated without whitespace." />
    <param name="FilterIncludedElements" type="text" value="C,H,N,O,P,S" optional="False" label="Filter Included Elements" help="List of elements that should be included. Elements are comma separated without whitespace." /> 
  </inputs>
  <outputs>
    <data name="metfragparameterfile" type="data" format="txt" label="${mspfile.display_name}_parameter.txt" />
  </outputs>
  <help>
.. class:: infomark

**Authors**

| **Kristian Peters (kpeters@ipb-halle.de)** wrote and maintains this module.

---------------------------------------------------

========================
MSP to MetFrag parameter
========================

-----------
Description
-----------

| Read spectra from MSP file and create MetFrag parameter file.

-----------
Input files
-----------

+------------------------------+------------+
| File                         |   Format   |
+==============================+============+
| 1)  MSP file(s)              |   MSP      |
+------------------------------+------------+

----------
Parameters
----------
	  
XCMS-Set file
	| A rdata file with XCMS-Set objects that were grouped by **xcms-collect-peaks**
        |

------------
Output files
------------
	
xcmssplit_input_1.rdata
	| (Multiple) rdata file(s) containing one XCMS-Set object each
        |


---------------------------------------------------

  </help>
</tool>

