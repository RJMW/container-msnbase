<?xml version='1.0' encoding='UTF-8'?>
<tool id="metfrag-vis2" name="metfrag-vis2" version="0.5">
  <requirements>
    <container type="docker">korseby/mtbls709</container>
  </requirements>
  <description>Generate a PDF summary for MetFrag result files</description>
  <stdio>
    <regex match="" source="stderr" level="warning" description="R messages" />
    <exit_code range="1:" level="fatal" description="Tool error" />
  </stdio>
  <command><![CDATA[
  	mkdir /tmp/outputdir/;
        bash /usr/local/bin/visualize-metfrag.sh $metfrag_vis_input_1 /tmp/outputdir/combined_top1_cands.csv $metfrag_vis_input_2;
        java -jar /usr/local/bin/ConvertMetFragCSV.jar csv=/tmp/outputdir/combined_top1_cands.csv output=/tmp/outputdir/combined_top1_cands.tex propertyWhiteList=Score,SampleName,Identifier,MolecularFormula,CompoundName,NumberPeaksUsed,NoExplPeaks,MetFragWebURL format=tex;
        pdflatex -output-directory /tmp/outputdir/ /tmp/outputdir/combined_top1_cands.tex;
        mv /tmp/outputdir/combined_top1_cands.pdf $metfrag_vis_output_1;
        rm -rf /tmp/outputdir/;
        rm /tmp/*.png;
  ]]>
  </command>
  <inputs>
    <param name="metfrag_vis_input_1" type="data" format="csv" multiple="True" optional="False" label="MetFrag result file(s)" />
    <param name="metfrag_vis_hits_limit" type="text" value="10" label="MetFrag Hits Limit" optional="False" help="Limit of hits returned per compound." />
    <param name="metfrag_synonyms" type="select" value="True" optional="False" label="Synonyms" help="Fetch synonyms from PubChem?">
      <option value="True" selected="True">True</option>
      <option value="False">False</option>
    </param>
    <param name="metfrag_classyfire" type="select" value="True" optional="False" label="ClassyFire" help="Fetch compound classes using ClassyFire?">
      <option value="True" selected="True">True</option>
      <option value="False">False</option>
    </param>
    <param name="metfrag_structure_method" type="select" value="cdk" optional="False" label="Structures" help="Create structures for MetFrag compounds.">
      <option value="cdk" selected="True">cdk</option>
      <option value="online">online</option>
    </param>
  </inputs>
  <outputs>
    <data name="metfrag_vis_output_1" type="data" format="pdf" label="Summary PDF file(s)" />	
  </outputs>
  <help>

.. class:: infomark

| **Tool update: See the 'NEWS' section at the bottom of the page**

---------------------------------------------------

.. class:: infomark

**Authors**

| **Kristian Peters (kpeters@ipb-halle.de)** wrote and maintains this wrapper for the generation of a MetFrag summary file.

---------------------------------------------------

=====================
MetFrag-Visualization
=====================

-----------
Description
-----------

| This module is used generate a summary PDF file from a MetFrag result file collection. The results are usually generated by the **metfrag-cli-batch**. The generated PDF file includes the Top1 entries of each result CSV file including an image of the candidate and properties. Optionally, the previously generated parameter files can be used as input to create query URLs for the MetFrag-Web tool.

+-------------------+
| predecessor tool  |
+-------------------+
| metfrag-cli-batch |
+-------------------+

-----------
Input files
-----------

+------------------------------+------------+
| File                         |   Format   |
+==============================+============+
| 1)  MetFrag result file      |    csv     |
|     collection               |            |
+------------------------------+------------+

----------
Parameters
----------

MetFrag result file collection
        | Collection of CSV files containing MetFrag results generated by **metfrag-cli-batch**
        |

MetFrag Synonyms
        | Fetch synonyms from Pubchem
        |

MetFrag ClassyFire
        | Fetch compound classes using ClassyFire
        |

MetFrag structures
        | Choose method how to draw pictures of the compounds
        |

------------
Output files
------------

metfrag_vis_output_1
        | Summary PDF file visualizing MetFrag results
        |

---------------------------------------------------

----
NEWS
----

CHANGES IN VERSION 0.5
========================

- rewrote module

  </help>
</tool>
